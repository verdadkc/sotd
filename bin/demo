#!/bin/bash

## Quickly and interactively generate shave of the day boilerplate for /r/wetshaving.
## Output is written to 'archive' directory, tagged with date, e.g. sotd.2021-05-03.
## The output targets the flavor of markdown used on reddit. Optionally can write as json.

## TOTALLY depends on the marvelous fzf utility being present.
## See https://github.com/junegunn/fzf#installation for installation details.
## You need fzf in your life. Will not work without fzf, just saying.

## Program developed and tested on macos Catalina. Should work on linux as is.
## Unlikely to work on Windows without changes. Maybe on Windows Linux Subsytem,
## but author does not have a Windows machine. You up for porting it?

##-- Define utility functions.
function push {  # append line to the sotd file
    printf "%s\n" "$1" >> "${sotd}"
}

function select_from {
   item="$(fzf < "$1")"  # this line is where the magic happens
   markdown="- **$2**"
   # user choice of 'none' results in nothing being returned
   if [[ "${item}" != "none" ]]; then
      echo "${markdown} ${item}"
   fi
}


# Grab the current date
when="$(date +%Y-%m-%d)"

# Create the name of the sotd file.
sotd="archive/sotd.${when}"

# Create the empty sotd file.
touch "${sotd}"  # In case we need a new file for a new day.
echo "" > "${sotd}" # If one already exists, wipe it. Allows for easy retry when desired.

# Grab user choices
lather=$(select_from "./lathers" "lather")
# Write user choices to the sotd file.

